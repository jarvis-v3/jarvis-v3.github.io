<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lampiran Dokumentasi Kinerja</title>
    <link href="css/tailwind.min.css" rel="stylesheet">
    <style>
        /* Styles untuk tampilan umum */
        .photo-cell {
            vertical-align: middle;
            text-align: center;
            padding: 0.5rem;
            width: 25%;
        }
        
        .photo-cell img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
            display: inline-block;
            max-height: 200px;
        }
    
        .number-cell {
            white-space: nowrap;
            padding: 4px;
            font-size: 10px;
            text-align: center;
        }
    
        .table-container {
            overflow-x: auto;
            margin: 0 auto;
            width: 100%;
            max-width: calc(100% - 2rem);
        }
    
        table {
            table-layout: auto;
            width: 100%;
            border-collapse: collapse;
            page-break-inside: auto;
        }
    
        th, td {
            border: 1px solid black;
            padding: 4px;
            font-size: 10px;
        }
    
        .activity-cell {
            text-align: left;
            padding: 4px;
        }
    
        .action-button {
            margin: 2px;
            display: block;
            width: 100%;
        }
    
        /* Styles untuk print dan PDF */
        @media print, screen {
            .no-print {
                display: none !important;
            }
            
            .table-container {
                max-width: 100%;
                margin: 0;
                overflow-x: visible;
            }
            
            .photo-cell {
                width: 25%;
                vertical-align: middle;
                text-align: center;
            }
    
            .photo-cell img {
                max-height: 4cm;
                width: auto;
                object-fit: contain;
                display: inline-block;
            }
    
            .number-cell {
                width: auto;
                white-space: nowrap;
                font-size: 10px;
                text-align: center;
            }
    
            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
    
            th, td {
                padding: 4px;
                border: 1px solid black;
                font-size: 10px;
            }
    
            .activity-cell {
                text-align: left;
                padding: 4px;
            }
    
            /* Pengaturan halaman untuk print */
            @page {
                size: auto;
                margin: 0;
            }
    
            /* Pengaturan konten utama */
            .max-w-6xl {
                padding: 10mm;
                margin: 0 auto;
                max-width: 100%;
            }
    
            /* Pengaturan font dan spacing */
            body {
                font-size: 10px;
                line-height: 1.4;
            }
        }
    
        /* Khusus untuk PDF via html2pdf.js */
        .pdf-mode {
            .table-container {
                overflow-x: visible !important;
            }
    
            .photo-cell img {
                max-height: 4cm !important;
            }
    
            table {
                page-break-inside: auto !important;
            }
    
            tr {
                page-break-inside: avoid !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-6xl mx-auto p-4">
        <div class="bg-white rounded px-8 pt-6 pb-8 mb-4">
            <div class="text-center mb-6">
                <h1 class="font-bold text-xl">LAMPIRAN</h1>
                <h2 class="font-bold text-xl">DOKUMENTASI KINERJA SUB BAGIAN MEKANIKAL ELECTRICAL POMPA & GENSET</h2>
                <h3 class="font-bold text-xl" id="periodText"></h3>
            </div>

            <div class="mb-6">
                <p class="text-gray-700">Berdasarkan dokumentasi kegiatan dilapangan, berikut lampiran foto kegiatan Tim Mekanikal Electrical Pompa dan Genset</p>
            </div>

            <!-- Kode untuk tombol-tombol -->
            <div class="action-buttons no-print">
                <a href="inputtukin.html" class="action-button bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Tambah Data
                </a>
                <button onclick="printDocument()" class="action-button bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Cetak
                </button>
                <button onclick="sharePDF()" class="action-button bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Bagikan PDF
                </button>
            </div>

            <div class="table-container">
                <table class="min-w-full" id="mainTable">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border px-4 py-2">NO</th>
                            <th class="border px-4 py-2">KETER ANGAN</th>
                            <th class="border px-4 py-2">SEBELUM PEKERJAAN</th>
                            <th class="border px-4 py-2">SEMENTARA PEKERJAAN</th>
                            <th class="border px-4 py-2">PEKERJAAN SELESAI</th>
                            <th class="border px-4 py-2 no-print">AKSI</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data akan diisi di sini -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

<script>
    // Fungsi untuk mencetak dokumen
    function printDocument() {
        window.print();
    }

    // Fungsi untuk membagikan PDF
    async function sharePDF() {
        try {
            // Cek apakah Web Share API tersedia
            if (navigator.share) {
                // Konversi halaman ke PDF menggunakan html2pdf
                const element = document.body;
                const opt = {
                    margin: 1,
                    filename: 'dokumentasi_kinerja.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                };

                // Tambahkan loading indicator
                const loadingDiv = document.createElement('div');
                loadingDiv.innerHTML = 'Menyiapkan PDF...';
                loadingDiv.style.position = 'fixed';
                loadingDiv.style.top = '50%';
                loadingDiv.style.left = '50%';
                loadingDiv.style.transform = 'translate(-50%, -50%)';
                loadingDiv.style.padding = '1rem';
                loadingDiv.style.backgroundColor = 'rgba(0,0,0,0.8)';
                loadingDiv.style.color = 'white';
                loadingDiv.style.borderRadius = '0.5rem';
                document.body.appendChild(loadingDiv);

                try {
                    const pdf = await html2pdf().set(opt).from(element).output('blob');
                    const file = new File([pdf], 'dokumentasi_kinerja.pdf', {
                        type: 'application/pdf'
                    });

                    await navigator.share({
                        files: [file],
                        title: 'Dokumentasi Kinerja',
                        text: 'Laporan Dokumentasi Kinerja'
                    });
                } catch (error) {
                    console.error('Error creating or sharing PDF:', error);
                    alert('Gagal membuat atau membagikan PDF. Silakan coba lagi.');
                } finally {
                    // Hapus loading indicator
                    document.body.removeChild(loadingDiv);
                }
            } else {
                // Jika Web Share API tidak tersedia, buka di tab baru
                alert('Fitur berbagi tidak tersedia di browser ini. Silakan gunakan tombol Cetak untuk menyimpan PDF.');
            }
        } catch (error) {
            console.error('Error sharing:', error);
            alert('Gagal membagikan file. Silakan coba lagi.');
        }
    }

    // Pastikan tombol-tombol terlihat saat halaman dimuat
    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('.action-button');
        buttons.forEach(button => {
            button.style.display = 'inline-flex';
        });
    });
</script>
    <script src="sharepdf.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</body>
</html>
